{% extends frame.html %}

{% block signin%}
    {% raw signin %}
{% end %}

{% block content %}
<section id = "content">
    <header>
    </header>
    <article class="post">
        <header>
            <h2>{% raw article["title"] %}</h2>
            <p>
                {% if article.has_key("updated_date") %}
                Updated by {% raw article["author"] %} on
                <time>{{ article["updated_date"].strftime("%Y-%m-%d %H:%M") }}</time>
                {% else %}
                Posted by {% raw article["author"] %} on
                <time>{% raw article["posted_date"].strftime("%Y-%m-%d %H:%M") %}</time>
                {% end %}
            </p>
        </header>

        {% raw article["content"] %}

        <footer>
            <nav>
                <ul>
                    {% if previous_article %}
                    <li><a href="/article/{% raw previous_article["href"] %}"> &lt&lt {%raw previous_article["title"] %} </a></li>
                    {% end %}
                    <li><a href="/">首页</a></li>
                    {% if next_article %}
                    <li><a href="/article/{% raw next_article["href"] %}"> {% raw next_article["title"] %} &gt&gt </a></li>
                    {% end %}
                </ul>
            </nav>

            {% if current_user %}
            <p> <a href="/update?article_href={% raw article["href"] %}"> <i> Edit</i></a> </p>
            {% end %}
        </footer>
    </article>

    <section id="comments">
        {% if article.has_key("comment") %}
        {% set article("comment") = article("comment")[::-1] %}
        {% set floor = 1 %}
        <h3>留言</h3>
        {% for comment in article["comment"] %}
        {% module comment(comment, floor) %}
        {% set floor = floor + 1 %}
        {% end %}
        {% end %}
    </section>

    <section>
        <h3>发表留言</h3>
        <form action="/comment" method="post">
            {% raw xsrf_form_html() %}
            <input type="hidden" name="article_href" value = {% raw article["href"] %}>

            <fieldset>
                <legend>评论 </legend>
                <ol>
                    <li>
                        <label for="name">姓名：</label>
                        <input type="text" name="comment_name">
                    </li>
                    <li>
                        <label for="email">email：</label>
                        <input type="text" name="comment_email" placeholder="me@example.com">
                    </li>
                    <li>
                        <label for="verify">验证码：</label>
                        <input type="text" name="verify" placeholder="请输入8" autocomplete = "off">
                    </li>
                    <li>
                        <label for="comment">输入评论:</label>
                        <textarea name="comment_content" cols=40 rows=8></textarea>
                    </li>
                    <li><input type="submit" value="submit"></li>
                </ol>
            </fieldset>
        </form>
    </section>
</section>
{% end %}
